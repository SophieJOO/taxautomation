/**
 * ì•„í˜„ì¬í•œì˜ì› íšŒê³„ ìë™í™” ì‹œìŠ¤í…œ v3.0
 * Google Sheets ì´ˆê¸° ì„¤ì • ìŠ¤í¬ë¦½íŠ¸
 * ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í•œ ë²ˆë§Œ ì‹¤í–‰í•˜ë©´ ëª¨ë“  ì‹œíŠ¸ì™€ í—¤ë”ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤
 */

/**
 * ë©”ë‰´ì— ì„¤ì • ë²„íŠ¼ ì¶”ê°€
 */
function onOpen() {
  try {
    const ui = SpreadsheetApp.getUi();
    ui.createMenu('ğŸ”§ ì‹œìŠ¤í…œ ì„¤ì •')
      .addItem('âš¡ ì´ˆê¸° ì„¤ì • ì‹¤í–‰', 'setupAhyunClinicSheets')
      .addItem('ğŸ”„ ì‹œíŠ¸ ì¬ìƒì„±', 'recreateAllSheets')
      .addItem('ğŸ“– ì„¤ì • ê°€ì´ë“œ', 'showSetupGuide')
      .addToUi();
  } catch (error) {
    Logger.log('ë©”ë‰´ ìƒì„± ì˜¤ë¥˜: ' + error.toString());
  }
}

/**
 * ë©”ì¸ ì„¤ì • í•¨ìˆ˜
 */
function setupAhyunClinicSheets() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  
  if (!ss) {
    Browser.msgBox('ì˜¤ë¥˜', 'ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', Browser.Buttons.OK);
    return;
  }
  
  const ui = SpreadsheetApp.getUi();
  
  const response = ui.alert(
    'ğŸ¥ ì•„í˜„ì¬í•œì˜ì› íšŒê³„ ì‹œìŠ¤í…œ ì„¤ì •',
    'ë‹¤ìŒ ì‹œíŠ¸ë“¤ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤:\n\n' +
    '1. ê±°ë˜ë‚´ì—­í†µí•©\n' +
    '2. ë¶„ë¥˜ê·œì¹™\n' +
    '3. ì›”ê°„ë³´ê³ ì„œ\n' +
    '4. ì„¸ë¬´ì‚¬ì „ë‹¬\n' +
    '5. CSVì„ì‹œ\n' +
    '6. ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­\n\n' +
    'ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
    ui.ButtonSet.YES_NO
  );
  
  if (response != ui.Button.YES) {
    ui.alert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
    return;
  }
  
  try {
    // ì§„í–‰ ìƒí™© í‘œì‹œ
    SpreadsheetApp.getActive().toast('ì„¤ì • ì‹œì‘...', 'ì§„í–‰ì¤‘', 3);
    
    // 1. ê±°ë˜ë‚´ì—­í†µí•© ì‹œíŠ¸
    SpreadsheetApp.getActive().toast('1/5: ê±°ë˜ë‚´ì—­í†µí•© ì‹œíŠ¸ ìƒì„± ì¤‘...', 'ì§„í–‰ì¤‘', 2);
    createTransactionSheet(ss);
    
    // 2. ë¶„ë¥˜ê·œì¹™ ì‹œíŠ¸
    SpreadsheetApp.getActive().toast('2/5: ë¶„ë¥˜ê·œì¹™ ì‹œíŠ¸ ìƒì„± ì¤‘...', 'ì§„í–‰ì¤‘', 2);
    createRulesSheet(ss);
    
    // 3. ì›”ê°„ë³´ê³ ì„œ ì‹œíŠ¸
    SpreadsheetApp.getActive().toast('3/5: ì›”ê°„ë³´ê³ ì„œ ì‹œíŠ¸ ìƒì„± ì¤‘...', 'ì§„í–‰ì¤‘', 2);
    createMonthlyReportSheet(ss);
    
    // 4. ì„¸ë¬´ì‚¬ì „ë‹¬ ì‹œíŠ¸
    SpreadsheetApp.getActive().toast('4/5: ì„¸ë¬´ì‚¬ì „ë‹¬ ì‹œíŠ¸ ìƒì„± ì¤‘...', 'ì§„í–‰ì¤‘', 2);
    createAccountantSheet(ss);
    
    // 5. CSVì„ì‹œ ì‹œíŠ¸
    SpreadsheetApp.getActive().toast('5/6: CSVì„ì‹œ ì‹œíŠ¸ ìƒì„± ì¤‘...', 'ì§„í–‰ì¤‘', 2);
    createTempSheet(ss);

    // 6. ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­ ì‹œíŠ¸
    SpreadsheetApp.getActive().toast('6/6: ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­ ì‹œíŠ¸ ìƒì„± ì¤‘...', 'ì§„í–‰ì¤‘', 2);
    createTaxMatchingSheet(ss);
    
    // ì™„ë£Œ
    SpreadsheetApp.getActive().toast('ì„¤ì • ì™„ë£Œ!', 'ì™„ë£Œ', 3);
    
    ui.alert(
      'âœ… ì„¤ì • ì™„ë£Œ!',
      'ëª¨ë“  ì‹œíŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n' +
      'ë‹¤ìŒ ë‹¨ê³„:\n' +
      '1. [í™•ì¥ í”„ë¡œê·¸ë¨] > [Apps Script] ì—´ê¸°\n' +
      '2. ì™¼ìª½ì—ì„œ ì½”ë“œ.gs í´ë¦­ (ë˜ëŠ” ìƒˆë¡œ ìƒì„±)\n' +
      '3. Code.gs íŒŒì¼ ë‚´ìš©ì„ ì „ì²´ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°\n' +
      '4. ì €ì¥ (ğŸ’¾) í›„ ì‹œíŠ¸ ë‹«ê¸°\n' +
      '5. Google Sheets ìƒˆë¡œê³ ì¹¨ (F5)\n' +
      '6. [ğŸ’° í•œì˜ì› íšŒê³„] ë©”ë‰´ í™•ì¸!\n\n' +
      'ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰',
      ui.ButtonSet.OK
    );
    
  } catch (error) {
    Logger.log('ì„¤ì • ì˜¤ë¥˜: ' + error.toString());
    ui.alert('ì˜¤ë¥˜ ë°œìƒ', 'ì˜¤ë¥˜: ' + error.toString() + '\n\në¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.', ui.ButtonSet.OK);
  }
}

/**
 * ëª¨ë“  ì‹œíŠ¸ ì¬ìƒì„±
 */
function recreateAllSheets() {
  const ui = SpreadsheetApp.getUi();
  
  const response = ui.alert(
    'âš ï¸ ëª¨ë“  ì‹œíŠ¸ ì¬ìƒì„±',
    'ê¸°ì¡´ ì‹œíŠ¸ê°€ ìˆìœ¼ë©´ ë‚´ìš©ì´ ì‚­ì œë©ë‹ˆë‹¤.\n\nì •ë§ ì¬ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
    ui.ButtonSet.YES_NO
  );
  
  if (response != ui.Button.YES) return;
  
  setupAhyunClinicSheets();
}

/**
 * ê±°ë˜ë‚´ì—­í†µí•© ì‹œíŠ¸ ìƒì„±
 */
function createTransactionSheet(ss) {
  if (!ss) throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
  
  let sheet = ss.getSheetByName('ê±°ë˜ë‚´ì—­í†µí•©');
  
  if (!sheet) {
    sheet = ss.insertSheet('ê±°ë˜ë‚´ì—­í†µí•©');
    Logger.log('ê±°ë˜ë‚´ì—­í†µí•© ì‹œíŠ¸ ìƒì„±ë¨');
  } else {
    sheet.clear();
    Logger.log('ê±°ë˜ë‚´ì—­í†µí•© ì‹œíŠ¸ í´ë¦¬ì–´ë¨');
  }
  
  // í—¤ë”
  const headers = [
    ['ì¼ì', 'ì¹´ë“œ/ê³„ì¢Œ', 'ê±°ë˜ì²˜', 'ì¶œê¸ˆì•¡', 'ì…ê¸ˆì•¡',
     'ìë™ë¶„ë¥˜', 'ìˆ˜ë™ë¶„ë¥˜', 'ìµœì¢…ë¶„ë¥˜', 'ì‚¬ì—…/ê°œì¸', 'ë©”ëª¨', 'ì„¸ê¸ˆê³„ì‚°ì„œ']
  ];

  sheet.getRange(1, 1, 1, headers[0].length).setValues(headers);

  // ìŠ¤íƒ€ì¼
  sheet.getRange(1, 1, 1, headers[0].length)
    .setFontWeight('bold')
    .setBackground('#4285f4')
    .setFontColor('#ffffff')
    .setHorizontalAlignment('center');

  // ì—´ ë„ˆë¹„
  sheet.setColumnWidth(1, 100);  // ì¼ì
  sheet.setColumnWidth(2, 150);  // ì¹´ë“œ/ê³„ì¢Œ
  sheet.setColumnWidth(3, 200);  // ê±°ë˜ì²˜
  sheet.setColumnWidth(4, 100);  // ì¶œê¸ˆì•¡
  sheet.setColumnWidth(5, 100);  // ì…ê¸ˆì•¡
  sheet.setColumnWidth(6, 120);  // ìë™ë¶„ë¥˜
  sheet.setColumnWidth(7, 120);  // ìˆ˜ë™ë¶„ë¥˜
  sheet.setColumnWidth(8, 120);  // ìµœì¢…ë¶„ë¥˜
  sheet.setColumnWidth(9, 100);  // ì‚¬ì—…/ê°œì¸
  sheet.setColumnWidth(10, 200); // ë©”ëª¨
  sheet.setColumnWidth(11, 120); // ì„¸ê¸ˆê³„ì‚°ì„œ
  
  // ê³ ì •
  sheet.setFrozenRows(1);
  
  Logger.log('ê±°ë˜ë‚´ì—­í†µí•© ì‹œíŠ¸ ì„¤ì • ì™„ë£Œ');
}

/**
 * ë¶„ë¥˜ê·œì¹™ ì‹œíŠ¸ ìƒì„±
 */
function createRulesSheet(ss) {
  if (!ss) throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
  
  let sheet = ss.getSheetByName('ë¶„ë¥˜ê·œì¹™');
  
  if (!sheet) {
    sheet = ss.insertSheet('ë¶„ë¥˜ê·œì¹™');
    Logger.log('ë¶„ë¥˜ê·œì¹™ ì‹œíŠ¸ ìƒì„±ë¨');
  } else {
    sheet.clear();
    Logger.log('ë¶„ë¥˜ê·œì¹™ ì‹œíŠ¸ í´ë¦¬ì–´ë¨');
  }
  
  // í—¤ë”
  const headers = [['ìš°ì„ ìˆœìœ„', 'ëŒ€ë¶„ë¥˜', 'ì¤‘ë¶„ë¥˜(ê³„ì •ê³¼ëª©)', 'í‚¤ì›Œë“œ', 'ì‚¬ì—…/ê°œì¸', 'ë©”ëª¨']];
  sheet.getRange(1, 1, 1, headers[0].length).setValues(headers);
  
  // ê¸°ë³¸ ë¶„ë¥˜ê·œì¹™ ì…ë ¥ - v3.0 ìµœì‹  ë²„ì „
  const rules = [
    // ========== ê³ ì •ë¹„ ==========
    [10, 'ê³ ì •ë¹„', 'ëŒ€í‘œì›ì¥ ê¸‰ì—¬', 'ëŒ€í‘œì›ì¥|ì›ì¥ê¸‰ì—¬', 'ì‚¬ì—…', 'ëŒ€í‘œì›ì¥ ê¸‰ì—¬'],
    [10, 'ê³ ì •ë¹„', 'ë¶€ì›ì¥ ê¸‰ì—¬', 'ë¶€ì›ì¥ê¸‰ì—¬', 'ì‚¬ì—…', 'ë¶€ì›ì¥ ê¸‰ì—¬'],
    [10, 'ê³ ì •ë¹„', 'ì§ì› ê¸‰ì—¬', '4ëŒ€ì‚¬íšŒë³´í—˜|4ëŒ€ë³´í—˜|ë„¤ì´ë²„í˜ì´|ì¹´ì¹´ì˜¤í˜ì´|í˜ì´ì½”|ê¸‰ì—¬|êµ­ë¯¼ì—°ê¸ˆ', 'ì‚¬ì—…', 'ì§ì› ê¸‰ì—¬ ë° 4ëŒ€ë³´í—˜'],
    [9, 'ê³ ì •ë¹„', 'ì„ëŒ€ë£Œ', 'ì›”ì„¸|ì„ëŒ€ë£Œ|ë¶€ë™ì‚°|ê±´ë¬¼', 'ì‚¬ì—…', 'í•œì˜ì› ì„ëŒ€ë£Œ'],
    [9, 'ê³ ì •ë¹„', 'ê´€ë¦¬ë¹„', 'êµ¬ë¡œêµ¬ì‹œì„¤ê´€ë¦¬ê³µë‹¨|ê´€ë¦¬ë¹„', 'ì‚¬ì—…', 'ê´€ë¦¬ë¹„'],
    [9, 'ê³ ì •ë¹„', 'ì „ê¸°', 'í•œì „|ì „ê¸°ìš”ê¸ˆ|ì „ë ¥', 'ì‚¬ì—…', 'ì „ê¸°ë£Œ'],
    [9, 'ê³ ì •ë¹„', 'ë„ì‹œê°€ìŠ¤', 'ê°€ìŠ¤ê³µì‚¬|ë„ì‹œê°€ìŠ¤', 'ì‚¬ì—…', 'ê°€ìŠ¤ìš”ê¸ˆ'],
    [8, 'ê³ ì •ë¹„', 'íê¸°ë¬¼', 'ì˜ë£Œíê¸°ë¬¼|íê¸°ë¬¼ì²˜ë¦¬', 'ì‚¬ì—…', 'íê¸°ë¬¼ ì²˜ë¦¬ë¹„'],
    [8, 'ê³ ì •ë¹„', 'EMR', 'ì°¨íŠ¸|EMR|ì „ìì˜ë¬´ê¸°ë¡', 'ì‚¬ì—…', 'EMR ì‹œìŠ¤í…œ'],
    [8, 'ê³ ì •ë¹„', 'í†µì‹ ë¹„', 'SKí…”ë ˆì½¤|SKT|KTí†µì‹ ìš”ê¸ˆ|KT|ì¸í„°ë„·|íœ´ëŒ€í°|ì „í™”', 'ì‚¬ì—…', 'í†µì‹ ë¹„'],
    [8, 'ê³ ì •ë¹„', 'ì •ìˆ˜ê¸°', 'ì •ìˆ˜ê¸°|ì½”ì›¨ì´|ì²­í˜¸ë‚˜ì´ìŠ¤', 'ì‚¬ì—…', 'ì •ìˆ˜ê¸° ë Œíƒˆ'],
    [8, 'ê³ ì •ë¹„', 'ë³´ì•ˆ', 'ë³´ì•ˆ|ê²½ë¹„|CCTV', 'ì‚¬ì—…', 'ë³´ì•ˆ ì„œë¹„ìŠ¤'],
    [7, 'ê³ ì •ë¹„', 'ì„¸ë¬´', 'ì„¸ë¬´ì‚¬|ì„¸ë¬´ê¸°ì¥|ì„¸ë¬´ëŒ€í–‰', 'ì‚¬ì—…', 'ì„¸ë¬´ì‚¬ ìˆ˜ìˆ˜ë£Œ'],
    [7, 'ê³ ì •ë¹„', 'ë°°ìƒë³´í—˜', 'ë°°ìƒì±…ì„|ì˜ë£Œë°°ìƒ', 'ì‚¬ì—…', 'ì˜ë£Œ ë°°ìƒì±…ì„ë³´í—˜'],
    [7, 'ê³ ì •ë¹„', 'ëŒ€ë‚´ë³´í—˜', 'í™”ì¬ë³´í—˜|ì‚¬ì—…ìë³´í—˜', 'ì‚¬ì—…', 'ëŒ€ë‚´ ë³´í—˜'],
    [7, 'ê³ ì •ë¹„', 'êµ­ì„¸', 'êµ­ì„¸|ì§€ë°©ì„¸|ì„¸ê¸ˆë‚©ë¶€', 'ì‚¬ì—…', 'ì„¸ê¸ˆ'],
    
    // ========== ë³€ë™ë¹„ ==========
    [10, 'ë³€ë™ë¹„', 'ì¹´ë“œìˆ˜ìˆ˜ë£Œ', 'ì¹´ë“œìˆ˜ìˆ˜ë£Œ|PGìˆ˜ìˆ˜ë£Œ|ê²°ì œìˆ˜ìˆ˜ë£Œ', 'ì‚¬ì—…', 'ì¹´ë“œ ê²°ì œ ìˆ˜ìˆ˜ë£Œ'],
    [9, 'ë³€ë™ë¹„', 'í™˜ë¶ˆ', 'í™˜ë¶ˆ|ì·¨ì†Œ|ë°˜í™˜', 'ì‚¬ì—…', 'í™˜ë¶ˆ ì²˜ë¦¬'],
    [9, 'ë³€ë™ë¹„', 'ì²­ì†Œ', 'ê·¸ë¦°ìº”í¬ë¦¬|ì—ì´ì¹˜ì—˜ë””|í•œë¼|ì²­ì†Œ', 'ì‚¬ì—…', 'ì²­ì†Œ ìš©ì—­'],
    [8, 'ë³€ë™ë¹„', 'ì‹ë¹„', 'ì´ë‘ë¶€ì•¼|ì§ì›ê°„ì‹|ë‹¨ì²´ì‹ì‚¬|ë‚˜ì£¼ê´€|ìˆ ê¹Œë½|íšŒì‹|ì§ì›ì‹ëŒ€', 'ì‚¬ì—…', 'ì§ì› ì‹ë¹„'],
    [8, 'ë³€ë™ë¹„', 'ì•½ì¬', 'í–‰ë¦¼ì›ì™¸íƒ•ì „|ì˜¥ì²œë‹¹|í•œì•½|ì•½ì¬|ìƒì•½|í•œë°©|ê²½í¬ì•½ì—…|ê´‘ë™|íƒ•ì „', 'ì‚¬ì—…', 'í•œì•½ì¬ ë° íƒ•ì „'],
    [7, 'ë³€ë™ë¹„', 'ë¹„í’ˆ', 'ì¹¨|ë¶€í•­|ëœ¸|ê±°ì¦ˆ|ì•Œì½”ì˜¬|ì†Œë…|ì˜ë£Œìš©|ë‹¤ì´ì†Œ|ë¬¸êµ¬|ì‚¬ë¬´ìš©í’ˆ|ë³µì‚¬', 'ì‚¬ì—…', 'ì˜ë£Œ/ì‚¬ë¬´ìš© ë¹„í’ˆ'],
    [6, 'ë³€ë™ë¹„', 'êµí†µë¹„', 'ì¹´ì¹´ì˜¤íƒì‹œ|íƒì‹œ|ìš°ë²„|íƒ€ë‹¤', 'í™•ì¸í•„ìš”', 'ì—…ë¬´ìš©ë§Œ ì¸ì •'],
    [6, 'ë³€ë™ë¹„', 'ì£¼ì°¨ì¥', 'ì£¼ì°¨|ì£¼ì°¨ì¥|ì£¼ì°¨ë¹„|í†¨ê²Œì´íŠ¸', 'ì‚¬ì—…', 'ì£¼ì°¨ ë° í†µí–‰ë£Œ'],
    [5, 'ë³€ë™ë¹„', 'ê°•ì˜', 'ê°•ì˜|êµìœ¡|ì„¸ë¯¸ë‚˜|í•™íšŒ', 'ì‚¬ì—…', 'êµìœ¡ ë° í•™íšŒë¹„'],
    [5, 'ë³€ë™ë¹„', 'MSO ìˆ˜ìˆ˜ë£Œ', 'MSO|ë§ˆì¼€íŒ…ìˆ˜ìˆ˜ë£Œ|ê´‘ê³ ëŒ€í–‰', 'ì‚¬ì—…', 'MSO ë§ˆì¼€íŒ… ìˆ˜ìˆ˜ë£Œ'],
    [5, 'ë³€ë™ë¹„', 'ë…¸ë€ìš°ì‚°ê³µì œ', 'ë…¸ë€ìš°ì‚°|ë…¸ë€ìš°ì‚°ê³µì œ', 'ì‚¬ì—…', 'ë…¸ë€ìš°ì‚° ê³µì œ'],
    
    // ========== ê°œì¸ì§€ì¶œ ==========
    [3, 'ê°œì¸ì§€ì¶œ', 'ì‹ë¹„', 'íŒŒë¦¬ë°”ê²Œëœ¨|ëšœë ˆì¥¬ë¥´|BBQ|ìŠ¤íƒ€ë²…ìŠ¤|ì¹´í˜', 'ê°œì¸', 'ê°œì¸ ì‹ì‚¬'],
    [3, 'ê°œì¸ì§€ì¶œ', 'ìƒí™œë¹„', 'ì¿ íŒ¡|ì¿ íŒ¡ì´ì¸ |VICë§ˆì¼“|ì„¸ë¸ì¼ë ˆë¸|GS25|CU|ì´ë§ˆíŠ¸', 'ê°œì¸', 'ê°œì¸ ìƒí™œìš©í’ˆ'],
    [3, 'ê°œì¸ì§€ì¶œ', 'ë°±í™”ì ', 'ì‹ ì„¸ê³„ë°±í™”ì |ë¡¯ë°ë°±í™”ì |í˜„ëŒ€ë°±í™”ì |í–‰ë³µí•œë°±í™”ì ', 'í™•ì¸í•„ìš”', 'ì‚¬ì—…/ê°œì¸ êµ¬ë¶„ í•„ìš”'],
    [3, 'ê°œì¸ì§€ì¶œ', 'ì°¨ëŸ‰', 'ì˜ì§„ì£¼ìœ ì†Œ|ì£¼ìœ |GSì¹¼í…ìŠ¤|SKì—ë„ˆì§€', 'ê°œì¸', 'ê°œì¸ ì°¨ëŸ‰ (ì‚¬ì—…ìš©ì€ ë³€ë™ë¹„)'],
    [3, 'ê°œì¸ì§€ì¶œ', 'ê¸°íƒ€ê°œì¸', 'ë‹¹ì‹ ì˜ì§‘ì‚¬|ë¹„ë„ì•„íŠ¸|ë§¤ë¨¸ë“œìµìŠ¤í”„ë ˆìŠ¤', 'ê°œì¸', 'ì• ì™„ë™ë¬¼, í•™ì› ë“±'],
    [2, 'ê°œì¸ì§€ì¶œ', 'ì˜ë¥˜ë¹„', 'ìœ ë‹ˆí´ë¡œ|ìë¼|H&M', 'ê°œì¸', 'ê°œì¸ ì˜ë¥˜'],
    
    // ========== ê¸°íƒ€ ==========
    [1, 'ê¸°íƒ€', 'ë¯¸ë¶„ë¥˜', '', 'í™•ì¸í•„ìš”', 'ê·œì¹™ ì—†ìŒ']
  ];
  
  if (rules.length > 0) {
    sheet.getRange(2, 1, rules.length, 6).setValues(rules);
  }
  
  // ìŠ¤íƒ€ì¼
  sheet.getRange(1, 1, 1, 6)
    .setFontWeight('bold')
    .setBackground('#34a853')
    .setFontColor('#ffffff')
    .setHorizontalAlignment('center');
  
  // ì—´ ë„ˆë¹„
  sheet.setColumnWidth(1, 80);   // ìš°ì„ ìˆœìœ„
  sheet.setColumnWidth(2, 100);  // ëŒ€ë¶„ë¥˜
  sheet.setColumnWidth(3, 150);  // ì¤‘ë¶„ë¥˜
  sheet.setColumnWidth(4, 400);  // í‚¤ì›Œë“œ
  sheet.setColumnWidth(5, 100);  // ì‚¬ì—…/ê°œì¸
  sheet.setColumnWidth(6, 200);  // ë©”ëª¨
  
  sheet.setFrozenRows(1);
  
  Logger.log('ë¶„ë¥˜ê·œì¹™ ì‹œíŠ¸ ì„¤ì • ì™„ë£Œ');
}

/**
 * ì›”ê°„ë³´ê³ ì„œ ì‹œíŠ¸ ìƒì„±
 */
function createMonthlyReportSheet(ss) {
  if (!ss) throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
  
  let sheet = ss.getSheetByName('ì›”ê°„ë³´ê³ ì„œ');
  
  if (!sheet) {
    sheet = ss.insertSheet('ì›”ê°„ë³´ê³ ì„œ');
    Logger.log('ì›”ê°„ë³´ê³ ì„œ ì‹œíŠ¸ ìƒì„±ë¨');
  } else {
    sheet.clear();
    Logger.log('ì›”ê°„ë³´ê³ ì„œ ì‹œíŠ¸ í´ë¦¬ì–´ë¨');
  }
  
  const headers = [['ì›”', 'ëŒ€ë¶„ë¥˜', 'ê³„ì •ê³¼ëª©', 'ì‚¬ì—…ì§€ì¶œ', 'ê°œì¸ì§€ì¶œ', 'í•©ê³„', 'ê±°ë˜ê±´ìˆ˜']];
  sheet.getRange(1, 1, 1, headers[0].length).setValues(headers);
  
  sheet.getRange(1, 1, 1, headers[0].length)
    .setFontWeight('bold')
    .setBackground('#fbbc04')
    .setFontColor('#000000')
    .setHorizontalAlignment('center');
  
  sheet.setFrozenRows(1);
  
  Logger.log('ì›”ê°„ë³´ê³ ì„œ ì‹œíŠ¸ ì„¤ì • ì™„ë£Œ');
}

/**
 * ì„¸ë¬´ì‚¬ì „ë‹¬ ì‹œíŠ¸ ìƒì„±
 */
function createAccountantSheet(ss) {
  if (!ss) throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
  
  let sheet = ss.getSheetByName('ì„¸ë¬´ì‚¬ì „ë‹¬');
  
  if (!sheet) {
    sheet = ss.insertSheet('ì„¸ë¬´ì‚¬ì „ë‹¬');
    Logger.log('ì„¸ë¬´ì‚¬ì „ë‹¬ ì‹œíŠ¸ ìƒì„±ë¨');
  } else {
    sheet.clear();
    Logger.log('ì„¸ë¬´ì‚¬ì „ë‹¬ ì‹œíŠ¸ í´ë¦¬ì–´ë¨');
  }
  
  const headers = [['ì¼ì', 'ê³„ì •ê³¼ëª©', 'ê±°ë˜ì²˜', 'ê¸ˆì•¡', 'ë©”ëª¨']];
  sheet.getRange(1, 1, 1, headers[0].length).setValues(headers);
  
  sheet.getRange(1, 1, 1, headers[0].length)
    .setFontWeight('bold')
    .setBackground('#ea4335')
    .setFontColor('#ffffff')
    .setHorizontalAlignment('center');
  
  sheet.setFrozenRows(1);
  
  Logger.log('ì„¸ë¬´ì‚¬ì „ë‹¬ ì‹œíŠ¸ ì„¤ì • ì™„ë£Œ');
}

/**
 * CSVì„ì‹œ ì‹œíŠ¸ ìƒì„±
 */
function createTempSheet(ss) {
  if (!ss) throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
  
  let sheet = ss.getSheetByName('CSVì„ì‹œ');
  
  if (!sheet) {
    sheet = ss.insertSheet('CSVì„ì‹œ');
    Logger.log('CSVì„ì‹œ ì‹œíŠ¸ ìƒì„±ë¨');
  } else {
    sheet.clear();
    Logger.log('CSVì„ì‹œ ì‹œíŠ¸ í´ë¦¬ì–´ë¨');
  }
  
  const headers = [['ì¼ì', 'ì¹´ë“œ/ê³„ì¢Œ', 'ê±°ë˜ì²˜', 'ì¶œê¸ˆì•¡', 'ì…ê¸ˆì•¡', 'ë©”ëª¨']];
  sheet.getRange(1, 1, 1, headers[0].length).setValues(headers);
  
  sheet.getRange(1, 1, 1, headers[0].length)
    .setFontWeight('bold')
    .setBackground('#9e9e9e')
    .setFontColor('#ffffff')
    .setHorizontalAlignment('center');
  
  // ì•ˆë‚´ ë©”ì‹œì§€
  sheet.getRange(3, 1, 1, 6).merge();
  sheet.getRange(3, 1)
    .setValue('ğŸ‘† ì—¬ê¸°ì— CSV ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (í—¤ë” í¬í•¨)')
    .setFontColor('#666666')
    .setFontStyle('italic');
  
  Logger.log('CSVì„ì‹œ ì‹œíŠ¸ ì„¤ì • ì™„ë£Œ');
}

/**
 * ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­ ì‹œíŠ¸ ìƒì„±
 */
function createTaxMatchingSheet(ss) {
  if (!ss) throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.');
  
  let sheet = ss.getSheetByName('ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­');
  
  if (!sheet) {
    sheet = ss.insertSheet('ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­');
    Logger.log('ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­ ì‹œíŠ¸ ìƒì„±ë¨');
  } else {
    sheet.clear();
    Logger.log('ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­ ì‹œíŠ¸ í´ë¦¬ì–´ë¨');
  }
  
  const headers = [[
    'ì‘ì„±ì¼ì', 'ê³µê¸‰ë°›ëŠ”ì', 'ê³µê¸‰ê°€ì•¡', 'ì„¸ì•¡', 'í•©ê³„ê¸ˆì•¡', 'ë¹„ê³ ', // ì„¸ê¸ˆê³„ì‚°ì„œ ì •ë³´
    'ë§¤ì¹­ìƒíƒœ', 'ë§¤ì¹­ì ìˆ˜', // ë§¤ì¹­ ê²°ê³¼
    'ê±°ë˜ì¼ì', 'ê±°ë˜ì²˜', 'ì…ê¸ˆì•¡', 'ì¶œê¸ˆì•¡', 'ë©”ëª¨' // ë§¤ì¹­ëœ ê±°ë˜ ë‚´ì—­
  ]];
  
  sheet.getRange(1, 1, 1, headers[0].length).setValues(headers);
  
  // ìŠ¤íƒ€ì¼
  sheet.getRange(1, 1, 1, headers[0].length)
    .setFontWeight('bold')
    .setBackground('#673ab7') // ë³´ë¼ìƒ‰
    .setFontColor('#ffffff')
    .setHorizontalAlignment('center');
    
  // ì—´ ë„ˆë¹„
  sheet.setColumnWidth(1, 100); // ì‘ì„±ì¼ì
  sheet.setColumnWidth(2, 150); // ê³µê¸‰ë°›ëŠ”ì
  sheet.setColumnWidth(3, 100); // ê³µê¸‰ê°€ì•¡
  sheet.setColumnWidth(4, 80);  // ì„¸ì•¡
  sheet.setColumnWidth(5, 100); // í•©ê³„ê¸ˆì•¡
  sheet.setColumnWidth(6, 150); // ë¹„ê³ 
  sheet.setColumnWidth(7, 100); // ë§¤ì¹­ìƒíƒœ
  sheet.setColumnWidth(8, 80);  // ë§¤ì¹­ì ìˆ˜
  sheet.setColumnWidth(9, 100); // ê±°ë˜ì¼ì
  sheet.setColumnWidth(10, 150); // ê±°ë˜ì²˜
  sheet.setColumnWidth(11, 100); // ì…ê¸ˆì•¡
  sheet.setColumnWidth(12, 100); // ì¶œê¸ˆì•¡
  sheet.setColumnWidth(13, 150); // ë©”ëª¨
  
  sheet.setFrozenRows(1);
  
  Logger.log('ì„¸ê¸ˆê³„ì‚°ì„œë§¤ì¹­ ì‹œíŠ¸ ì„¤ì • ì™„ë£Œ');
}

/**
 * ì„¤ì • ê°€ì´ë“œ í‘œì‹œ
 */
function showSetupGuide() {
  const ui = SpreadsheetApp.getUi();
  
  const message = `ğŸ¥ ì•„í˜„ì¬í•œì˜ì› íšŒê³„ ì‹œìŠ¤í…œ - ì„¤ì • ê°€ì´ë“œ\n\n` +
    `ğŸ“‹ ì„¤ì • ìˆœì„œ:\n\n` +
    `1ï¸âƒ£ [âš¡ ì´ˆê¸° ì„¤ì • ì‹¤í–‰] í´ë¦­\n` +
    `   â†’ ëª¨ë“  ì‹œíŠ¸ ìë™ ìƒì„±\n\n` +
    `2ï¸âƒ£ [í™•ì¥ í”„ë¡œê·¸ë¨] > [Apps Script] ì—´ê¸°\n` +
    `   â†’ ì½”ë“œ.gs (ë˜ëŠ” ìƒˆ íŒŒì¼) í´ë¦­\n` +
    `   â†’ Code.gs ë‚´ìš© ì „ì²´ ë¶™ì—¬ë„£ê¸°\n` +
    `   â†’ ì €ì¥ (ğŸ’¾)\n\n` +
    `3ï¸âƒ£ ìŠ¤í¬ë¦½íŠ¸ í¸ì§‘ê¸° ë‹«ê¸°\n\n` +
    `4ï¸âƒ£ Google Sheets ìƒˆë¡œê³ ì¹¨ (F5)\n` +
    `   â†’ [ğŸ’° í•œì˜ì› íšŒê³„] ë©”ë‰´ ìƒì„± í™•ì¸\n\n` +
    `5ï¸âƒ£ Python ìŠ¤í¬ë¦½íŠ¸ë¡œ ë°ì´í„° íŒŒì‹±\n` +
    `   â†’ run.bat (Windows) ë˜ëŠ” run.sh (Mac) ì‹¤í–‰\n\n` +
    `6ï¸âƒ£ CSVë¥¼ [CSVì„ì‹œ] ì‹œíŠ¸ì— ë¶™ì—¬ë„£ê¸°\n\n` +
    `7ï¸âƒ£ [ğŸ’° í•œì˜ì› íšŒê³„] > [ğŸš€ ì›í´ë¦­ ìë™ì²˜ë¦¬] í´ë¦­\n\n` +
    `âœ… ì™„ë£Œ!`;
  
  ui.alert('ì„¤ì • ê°€ì´ë“œ', message, ui.ButtonSet.OK);
}
