# 세금계산서 매칭 기능 사용 가이드

## 개요
홈택스 세금계산서와 은행 입출금 내역을 자동으로 대조(매칭)하는 **세금계산서 매칭** 기능이 추가되었습니다.

### 주요 기능
1.  **유사 이름 매칭 (Fuzzy Matching)**: 거래처 이름이 조금 달라도 자동으로 찾아줍니다. (예: "(주)아현재" vs "아현재한의원")
2.  **복합 금액 매칭 (부분합)**:
    -   **분할 입금**: 하나의 세금계산서를 여러 번 나누어 입금한 경우를 찾아냅니다.
    -   **통합 입금**: 여러 세금계산서를 한 번에 입금한 경우를 찾아냅니다.
3.  **전용 화면**: `세금계산서매칭` 시트에서 매칭 결과를 한눈에 확인하고 관리할 수 있습니다.

## 설정 방법
1.  구글 스프레드시트를 엽니다.
2.  **확장 프로그램 > Apps Script** 메뉴로 이동합니다.
3.  제공된 `TaxInvoiceMatcher.gs`와 `Test_TaxMatching.gs` 코드를 프로젝트에 복사해 넣습니다.
4.  `Setup.gs`, `code.gs`, `CSVUploader.html` 파일도 업데이트된 내용으로 수정합니다.
5.  스프레드시트를 새로고침합니다.
6.  **💰 한의원 회계 > 🔧 시스템 설정 > ⚡ 초기 설정 실행**을 클릭하여 `세금계산서매칭` 시트를 생성합니다.

## 사용 방법

### 1단계: 세금계산서 업로드
1.  **💰 한의원 회계 > 🧾 세금계산서 관리 > ① 세금계산서 업로드** 메뉴를 클릭합니다.
2.  **🧾 세금계산서 (홈택스)** 라디오 버튼을 선택합니다.
3.  홈택스에서 다운로드한 엑셀/CSV 파일을 업로드합니다.
    -   *참고: CSV 파일은 [작성일자, 공급받는자, 공급가액, 세액, 합계금액, 비고] 순서의 열을 포함해야 합니다.*

### 2단계: 매칭 실행
1.  **💰 한의원 회계 > 🧾 세금계산서 관리 > ② 매칭 실행** 메뉴를 클릭합니다.
2.  시스템이 `세금계산서매칭` 시트와 `거래내역통합` 시트를 비교 분석합니다.
3.  매칭 결과는 다음과 같이 표시됩니다:
    -   **정확**: 금액과 거래처명이 정확히 일치함 (100%)
    -   **유사**: 금액은 일치하나 이름이 조금 다름 (유사도 70% 이상)
    -   **복합**: 여러 입금 내역의 합계가 세금계산서 금액과 일치함

### 3단계: 결과 확인
-   `세금계산서매칭` 시트의 G열(매칭상태)과 H열(매칭점수)을 확인하세요.
-   매칭이 잘못된 경우, 해당 행의 매칭 정보를 수동으로 지우거나 수정하시면 됩니다.

## 검증 (테스트 스크립트)
실제 데이터 없이 로직을 확인하고 싶다면:
1.  **Apps Script**를 엽니다.
2.  `Test_TaxMatching.gs` 파일을 엽니다.
3.  `testTaxMatchingLogic` 함수를 실행합니다.
4.  **실행 로그**에서 유사 이름 매칭과 복합 금액 매칭이 성공(PASS)했는지 확인합니다.

## 문제 해결
-   **매칭이 안 되나요?** 날짜 차이가 3일 이내인지 확인해보세요.
-   **이름이 너무 다른가요?** `분류규칙` 시트에 해당 거래처를 추가하거나, 이름 유사도가 너무 낮은지(70% 미만) 확인해보세요.
