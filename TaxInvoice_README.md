# 세금계산서 대조 시스템 v1.0

기업은행 거래내역과 홈택스 세금계산서 발행내역을 자동으로 대조하는 독립 시스템입니다.

## 📋 특징

- ✅ **1년치 데이터 한 번에 처리**: 월별로 나누지 않고 전체 기간 데이터 대조
- ✅ **출금/입금 모두 지원**: 입금뿐만 아니라 출금 거래도 확인
- ✅ **거래처명 부분 일치**: "한메디"와 "한메디로" 자동 매칭
- ✅ **금액 허용 오차**: ±1% 또는 ±1,000원 범위 내 매칭
- ✅ **월별 통계**: 월별 발행률 자동 계산

## 🚀 설치 방법

### 1. 새 Google Sheets 생성
1. Google Sheets에서 새 스프레드시트 생성
2. 이름 설정 (예: "세금계산서 대조")

### 2. Apps Script 설정
1. **확장 프로그램** > **Apps Script** 클릭
2. 기본 `코드.gs` 파일 삭제
3. **+** 버튼으로 2개 파일 추가:
   - `TaxInvoiceSetup.gs`
   - `TaxInvoiceChecker.gs`
4. 각 파일에 해당 코드 복사/붙여넣기
5. **저장** (💾)

### 3. 초기 설정 실행
1. Google Sheets로 돌아가기
2. 새로고침 (F5)
3. 메뉴에서 **🔧 시스템 설정** > **⚡ 초기 설정 실행** 클릭
4. 3개 시트 자동 생성 확인:
   - 기업은행거래내역
   - 세금계산서발행내역
   - 대조결과

## 📊 사용 방법

### 1단계: 기업은행 거래내역 입력

**[기업은행거래내역]** 시트에 1년치 데이터 붙여넣기:

| 일자 | 거래처 | 금액 | 입금/출금 | 메모 |
|------|--------|------|-----------|------|
| 2024-01-15 | 한메디로 | 71500 | 출금 | 의료용품 |
| 2024-02-20 | 행림원외탕전 | 150000 | 출금 | 한약재 |
| 2024-03-10 | 서울병원 | 200000 | 입금 | 진료수입 |

**필수 입력:**
- 일자 (YYYY-MM-DD 형식)
- 거래처 (거래처명)
- 금액 (숫자)

**선택 입력:**
- 입금/출금 (자동 인식용, 없어도 됨)
- 메모

### 2단계: 세금계산서 발행내역 입력

**[세금계산서발행내역]** 시트에 홈택스 데이터 붙여넣기:

| 발행일자 | 거래처명 | 공급가액 | 세액 | 합계금액 | 승인번호 | 메모 |
|----------|----------|----------|------|----------|----------|------|
| 2024-01-15 | 한메디 | 65000 | 6500 | 71500 | INV-001 | |
| 2024-02-20 | 행림 | 136364 | 13636 | 150000 | INV-002 | |

**필수 입력:**
- 발행일자
- 거래처명
- 공급가액 또는 합계금액

**홈택스 데이터 다운로드 방법:**
1. 홈택스 로그인
2. **조회/발급** > **전자세금계산서** > **발행내역 조회**
3. 기간 설정 (1년치)
4. **엑셀 다운로드**
5. 다운로드된 엑셀 열어서 복사 → Google Sheets에 붙여넣기

### 3단계: 대조 실행

메뉴에서 **🔍 세금계산서 대조** > **▶️ 전체 대조 실행** 클릭

**[대조결과]** 시트에 결과 표시:

| 일자 | 거래처 | 금액 | 입금/출금 | 매칭상태 | 비고 |
|------|--------|------|-----------|----------|------|
| 2024-01-15 | 한메디로 | 71500 | 출금 | ✅ 발행확인 | 매칭됨 (발행일: 2024-01-15, 금액: 71,500원) |
| 2024-04-20 | 삼성전자 | 100000 | 출금 | ⚠️ 미발행 의심 | 홈택스 발행내역에서 찾을 수 없음 |

- 🟢 **초록색**: 세금계산서 발행 확인됨
- 🔴 **빨간색**: 미발행 의심 (확인 필요)

## 📈 추가 기능

### 월별 통계 보기
**🔍 세금계산서 대조** > **📊 통계 보기**

```
📊 월별 통계

2024-03
  총 15건 (1,500,000원)
  ✅ 발행: 12건 (80.0%)
  ⚠️ 미발행: 3건 (300,000원)

2024-02
  총 20건 (2,000,000원)
  ✅ 발행: 18건 (90.0%)
  ⚠️ 미발행: 2건 (200,000원)
```

### 결과 초기화
**🔍 세금계산서 대조** > **🗑️ 결과 초기화**

대조결과 시트를 깨끗하게 초기화합니다.

## 🔧 매칭 로직

### 거래처명 매칭
다음 경우 동일 거래처로 인식:

1. **정확히 일치**: "한메디" = "한메디"
2. **부분 일치**:
   - "한메디" ↔ "한메디로"
   - "서울병원" ↔ "서울병원의원"
   - "행림" ↔ "행림원외탕전"

**정규화 처리:**
- 공백 제거
- 괄호 안 내용 제거
- 회사 형태 제거 (주식회사, ㈜ 등)
- 소문자 변환

### 금액 매칭
다음 범위 내에서 동일 금액으로 인식:

- **±1%** 또는 **±1,000원** 중 큰 값

예시:
- 71,500원 거래 → 70,785원 ~ 72,215원 범위 매칭
- 10,000원 거래 → 9,000원 ~ 11,000원 범위 매칭

## ⚠️ 주의사항

1. **날짜 형식**: YYYY-MM-DD 형식 권장 (예: 2024-01-15)
2. **금액**: 숫자만 입력 (쉼표 자동 처리됨)
3. **거래처명**: 정확할수록 좋지만 부분 일치도 지원
4. **중복 확인**: 같은 거래처, 같은 금액의 거래가 여러 건이면 첫 번째만 매칭

## 📝 팁

- **대량 데이터**: 1년치 데이터(수백~수천 건)도 문제없이 처리
- **정기 대조**: 분기별 또는 월별로 정기적으로 대조 권장
- **엑셀 활용**: 결과를 엑셀로 다운로드하여 세무사 전달 가능
- **필터링**: Google Sheets 필터 기능으로 미발행 건만 볼 수 있음

## 🆘 문제 해결

### "시트를 찾을 수 없습니다" 오류
→ **시스템 설정** > **초기 설정 실행** 클릭

### "데이터가 없습니다" 오류
→ 해당 시트에 데이터(헤더 아래)가 있는지 확인

### 매칭이 안 됨
→ 거래처명과 금액 확인 (오타, 띄어쓰기 등)

### 날짜 형식 오류
→ YYYY-MM-DD 형식으로 변경 (예: 2024-01-15)

## 📞 지원

문제가 있거나 개선 사항이 있으면 이슈를 등록해주세요.

---

**버전**: 1.0
**최종 업데이트**: 2024-01-15
**라이선스**: MIT
